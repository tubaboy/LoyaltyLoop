# LoyaltyLoop: Supabase Cloud to Zeabur é·ç§»æŒ‡å—

æœ¬æŒ‡å—è©³ç´°èªªæ˜å¦‚ä½•å°‡ `LoyaltyLoop` å°ˆæ¡ˆå¾ Supabase Cloud æ¬é·åˆ° Zeabur è¨—ç®¡çš„ self-hosted Supabase ç’°å¢ƒã€‚

---

## ğŸ—ï¸ æº–å‚™å·¥ä½œ

1. **å®‰è£ Supabase CLI**:
   ```bash
   npm install -g supabase
   ```
2. **æº–å‚™ API Keys**:
   - å–å¾—é›²ç«¯çš„ `URL` èˆ‡ `service_role_key`ã€‚
   - å–å¾— Zeabur çš„ `URL` èˆ‡ `service_role_key`ã€‚

---

## 1. è³‡æ–™åº«é·ç§» (Schema & Data)

### A. åŒ¯å‡º/åŒ¯å…¥ Schema
1. ç™»å…¥ Supabase Cloud æ§åˆ¶å°ï¼Œé€²å…¥ **SQL Editor**ã€‚
2. åŒ¯å‡ºç›®å‰çš„ DDL (Schema)ã€‚
3. åœ¨ Zeabur çš„ Supabase SQL Editor ä¸­åŸ·è¡Œï¼Œå»ºç«‹æ‰€æœ‰ Tableã€‚

### B. è³‡æ–™æ¬ç§» (æ¨è–¦ä½¿ç”¨è…³æœ¬)
åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹å·²æº–å‚™å¥½é·ç§»è…³æœ¬çµæ§‹ï¼š
1. é€²å…¥ `scripts/migration`ã€‚
2. è¨­å®š `.env` (å¡«å¯« source èˆ‡ target çš„ key)ã€‚
3. åŸ·è¡Œæ¬é·ï¼š
   ```bash
   node migrate.js
   ```

---

## 2. èº«ä»½é©—è­‰é·ç§» (Auth)

> [!WARNING]
> Supabase Cloud é™åˆ¶ç›´æ¥åŒ¯å‡ºåŠ å¯†å¾Œçš„å¯†ç¢¼ã€‚

### æ­¥é©Ÿï¼š
1. **å»ºç«‹ç®¡ç†å“¡**: åœ¨ Zeabur Console æ‰‹å‹•å»ºç«‹ä¸€å€‹ç›¸åŒ Email çš„ Userã€‚
2. **å°é½Š ID**: è¤‡è£½æ–° User çš„ UUIDï¼Œä¸¦åœ¨è³‡æ–™åº«ä¸­æ›´æ–° `profiles` è¡¨ï¼š
   ```sql
   UPDATE profiles SET id = 'æ–°UUID' WHERE email = 'admin@example.com';
   ```
3. **å•†å®¶ç®¡ç†å“¡**: å»ºè­°è®“å•†å®¶é‡æ–°è¨»å†Šï¼Œæˆ–ä½¿ç”¨ `supabase.auth.admin.createUser` è…³æœ¬æ‰¹æ¬¡å»ºç«‹ä¸¦å¼·è¡ŒæŒ‡å®š IDï¼ˆä¿æŒèˆ‡ `merchants` è¡¨é—œè¯ï¼‰ã€‚

---

## 3. Edge Functions é·ç§»

æˆ‘å·²å°‡é›²ç«¯çš„ `admin-create-merchant` åŸå§‹ç¢¼è£œå›è‡³æœ¬åœ° `supabase/functions` è³‡æ–™å¤¾ã€‚

### éƒ¨ç½²æ­¥é©Ÿï¼š
1. **é€£çµå°ˆæ¡ˆ**:
   ```bash
   supabase link --project-ref [ä½ çš„_ZEABUR_PROJECT_REF]
   ```
2. **è¨­å®š Secrets**:
   Zeabur ç«¯éœ€è¦è®“ Function è®€å–è³‡æ–™åº«ï¼Œè«‹è¨­å®šå¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼š
   ```bash
   supabase secrets set SUPABASE_SERVICE_ROLE_KEY=...
   ```
3. **æ­£å¼éƒ¨ç½²**:
   ```bash
   supabase functions deploy admin-create-merchant
   ```

---

## 4. å‰ç«¯æ›´æ–°

ä¿®æ”¹æœ¬åœ°æˆ– Zeabur ä¸Šçš„ `.env` ç’°å¢ƒè®Šæ•¸ï¼š

```env
VITE_SUPABASE_URL=ä½ çš„_ZEABUR_SUPABASE_ç¶²å€
VITE_SUPABASE_ANON_KEY=ä½ çš„_ZEABUR_ANON_KEY
```

---

## ğŸ’¡ å¸¸è¦‹å•é¡Œ FAQ

*   **ç‚ºä»€éº¼ white screen?** æª¢æŸ¥ Zeabur çš„ `vite.config.js` è£¡çš„ `base` åƒæ•¸æ˜¯å¦è¨­ç‚º `/`ã€‚
*   **ç‚ºä½• Function å ±éŒ¯ 404?** è¡¨ç¤º Function é‚„æ²’æˆåŠŸ deploy æˆ–åå­—æ‰“éŒ¯ã€‚

---
*Generated by Antigravity (LoyaltyLoop AI Assistant)*
